# Analyzing vulnerability of California's electricity distribution infrastructure to wildfires

This repo is a temporary code repo for peer review. It will be made public before publication.

The operating system for developing this code repo is Ubuntu 16.04, but it should also be able to run in other environments. The Python version used for developing this code repo is Python 3.6.

## Install required packages

Run the following command line:

```
$ pip install -r requirements.txt
```

## Download data and model checkpoints

Run the following command lines to download the ZIP files right under the code repo directory:

```
$ curl -O https://opendatasharing.s3.us-west-2.amazonaws.com/vulnerability/checkpoint.zip
$ curl -O https://opendatasharing.s3.us-west-2.amazonaws.com/vulnerability/dataset.zip
$ curl -O https://opendatasharing.s3.us-west-2.amazonaws.com/vulnerability/results.zip
$ curl -O https://opendatasharing.s3.us-west-2.amazonaws.com/vulnerability/grid_and_wildfire_maps.zip
```

Unzip them such that the directory structure looks like:

```
vulnerability/checkpoint/...
vulnerability/dataset/...
vulnerability/results/...
vulnerability/grid_and_wildfire_maps/...
```

Note that for the street view imagery dataset under `dataset`, due to the restriction of the imagery data source, we are not able to publicly share the full training/validation set. Instead, we sample 20 images as a demo training set and 20 images as a demo validation set. However, we share the full image test set for peer-review purpose only.

## Functionality of each script/notebook

`test_classification_pytorch_for_lines.py`: This script loads the trained power line identification model checkpoint `checkpoint/deepGrid_seg_pretrained.tar` and runs it on the image test set. The expected precision and recall under the given threshold 0.5 are 0.982 and 0.937, respectively.

`train_classification_pytorch_for_lines.py`: This script trains the power line identification model using the images in the training set and saves the model with the best performance on the validation set. A pre-trained model can be specified. The default pre-trained model is the model pretrained on ImageNet dataset: `checkpoint/inception_v3_google-1a9a5a14.pth`.

`analyze_line_burying_status.ipynb`: This notebook is used for analyzing the line-burying status at the census block group level and correlating it with regional characteristics including wildfire probability and demographic data. It can be used to generate the plots in Figure 3 and Figure 4.

`spatial_map_visualization.ipynb`: This notebook is used for visualizing the block-group-level geospatial distribution of various characteristics such as undergrounding rate, wildfire risks, and median household income across the territories of PG&E and SCE. It can be used to generated the plots in Figure 2.

`obtain_affected_power_lines.py`: This script estimates the total length of power lines across the entire utility territory that would be potentially affected by fire-prone power lines in each block group. It can be further used to estimate the number of buildings that could be potentially affected. The algorithm is based on the Breadth First Search algorithm run on distribution grids.

`visualize_number_of_potentially_affected_buildings.ipynb`: This script estimates the number of buildings across the entire utility territory that could be potentially affected by overhead fire-prone lines in each block group, and visualize its geospatial distribution. It can be used to generated the plots in Figure 5.

